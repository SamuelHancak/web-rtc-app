{"ast":null,"code":"import _toConsumableArray from\"/Users/samuelhancak/Documents/WebRTC/web-rtc-audio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/samuelhancak/Documents/WebRTC/web-rtc-audio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/samuelhancak/Documents/WebRTC/web-rtc-audio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/samuelhancak/Documents/WebRTC/web-rtc-audio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/samuelhancak/Documents/WebRTC/web-rtc-audio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import io from\"socket.io-client\";//import logo from \"./logo.svg\";\nimport\"./App.css\";//import { PeerConnection } from \"./PeerConnection\";\nvar App=/*#__PURE__*/function(_Component){_inherits(App,_Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.componentDidMount=function(){_this.socket=io(\"/webrtcPeer\",{path:\"/web-rtc-audio\",query:{}});_this.socket.on(\"connection-success\",function(success){console.log(success);});_this.socket.on(\"offerOrAnswer\",function(sdp){_this.textRef.value=JSON.stringify(sdp);});_this.socket.on(\"candidate\",function(candidate){_this.candidates=[].concat(_toConsumableArray(_this.candidates),[candidate]);});var pc_config=null;_this.pc=new RTCPeerConnection(pc_config);_this.pc.onicecandidate=function(e){if(e.candidate){_this.sendToPeer(\"candidate\",e.candidate);}};_this.pc.oniceconnectionstatechange=function(e){console.log(e);};_this.pc.ontrack=function(e){_this.remoteVideoRef.current.srcObject=e.streams[0];};var constraints={video:true};var success=function success(stream){window.localStream=stream;_this.localVideoRef.current.srcObject=stream;_this.pc.addStream(stream);};var fail=function fail(e){console.log(\"getUserMedia error: \",e);};navigator.mediaDevices.getUserMedia(constraints).then(success).catch(fail);};_this.sendToPeer=function(messageType,payload){_this.socket.emit(messageType,{socketID:_this.socket.id,payload:payload});};_this.createOffer=function(){console.log(\"Offer\");_this.pc.createOffer({offerToReceiveVideo:1}).then(function(sdp){_this.pc.setLocalDescription(sdp);_this.sendToPeer(\"offerOrAnswer\",sdp);});};_this.setRemoteDescription=function(){// retrieve and parse the SDP copied from the remote peer\nvar desc=JSON.parse(_this.textref.value);// set sdp as remote description\n_this.pc.setRemoteDescription(new RTCSessionDescription(desc));};_this.createAnswer=function(){console.log(\"Answer\");_this.pc.createAnswer({offerToReceiveVideo:1}).then(function(sdp){_this.pc.setLocalDescription(sdp);_this.sendToPeer(\"offerOrAnswer\",sdp);});};_this.addCandidate=function(){/* const candidate = JSON.parse(this.textref.value);\n    console.log(\"Adding candidate:\", candidate);\n\n    this.pc.addIceCandidate(new RTCIceCandidate(candidate)); */_this.candidates.forEach(function(candidate){console.log(JSON.stringify(candidate));_this.pc.addIceCandidate(new RTCIceCandidate(candidate));});};_this.localVideoRef=React.createRef();_this.remoteVideoRef=React.createRef();_this.socket=null;_this.candidates=[];return _this;}_createClass(App,[{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"video\",{style:{width:240,height:240,margin:5,backgroundColor:\"black\"},ref:this.localVideoRef,autoPlay:true}),/*#__PURE__*/React.createElement(\"video\",{style:{width:240,height:240,margin:5,backgroundColor:\"black\"},ref:this.remoteVideoRef,autoPlay:true}),/*#__PURE__*/React.createElement(\"button\",{onClick:this.createOffer},\"Offer\"),/*#__PURE__*/React.createElement(\"button\",{onClick:this.createAnswer},\"Answer\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"textarea\",{style:{width:450,height:40},ref:function ref(_ref){_this2.textref=_ref;}}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"button\",{onClick:this.setRemoteDescription},\"Set remote description\"),/*#__PURE__*/React.createElement(\"button\",{onClick:this.addCandidate},\"Add cadidate\"));}/* render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <h1 className=\"App-title\"> Welcome to React </h1>\n        </header>\n        <PeerConnection />\n      </div>\n    );\n  } */}]);return App;}(Component);export default App;","map":{"version":3,"sources":["/Users/samuelhancak/Documents/WebRTC/web-rtc-audio/src/App.js"],"names":["React","Component","io","App","props","componentDidMount","socket","path","query","on","success","console","log","sdp","textRef","value","JSON","stringify","candidate","candidates","pc_config","pc","RTCPeerConnection","onicecandidate","e","sendToPeer","oniceconnectionstatechange","ontrack","remoteVideoRef","current","srcObject","streams","constraints","video","stream","window","localStream","localVideoRef","addStream","fail","navigator","mediaDevices","getUserMedia","then","catch","messageType","payload","emit","socketID","id","createOffer","offerToReceiveVideo","setLocalDescription","setRemoteDescription","desc","parse","textref","RTCSessionDescription","createAnswer","addCandidate","forEach","addIceCandidate","RTCIceCandidate","createRef","width","height","margin","backgroundColor","ref"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport io from \"socket.io-client\";\n//import logo from \"./logo.svg\";\nimport \"./App.css\";\n//import { PeerConnection } from \"./PeerConnection\";\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.localVideoRef = React.createRef();\n    this.remoteVideoRef = React.createRef();\n\n    this.socket = null;\n    this.candidates = [];\n  }\n\n  componentDidMount = () => {\n    this.socket = io(\"/webrtcPeer\", {\n      path: \"/web-rtc-audio\",\n      query: {},\n    });\n\n    this.socket.on(\"connection-success\", (success) => {\n      console.log(success);\n    });\n\n    this.socket.on(\"offerOrAnswer\", (sdp) => {\n      this.textRef.value = JSON.stringify(sdp);\n    });\n\n    this.socket.on(\"candidate\", (candidate) => {\n      this.candidates = [...this.candidates, candidate];\n    });\n\n    const pc_config = null;\n\n    this.pc = new RTCPeerConnection(pc_config);\n\n    this.pc.onicecandidate = (e) => {\n      if (e.candidate) {\n        this.sendToPeer(\"candidate\", e.candidate);\n      }\n    };\n\n    this.pc.oniceconnectionstatechange = (e) => {\n      console.log(e);\n    };\n\n    this.pc.ontrack = (e) => {\n      this.remoteVideoRef.current.srcObject = e.streams[0];\n    };\n\n    const constraints = { video: true };\n\n    const success = (stream) => {\n      window.localStream = stream;\n      this.localVideoRef.current.srcObject = stream;\n      this.pc.addStream(stream);\n    };\n\n    const fail = (e) => {\n      console.log(\"getUserMedia error: \", e);\n    };\n\n    navigator.mediaDevices.getUserMedia(constraints).then(success).catch(fail);\n  };\n\n  sendToPeer = (messageType, payload) => {\n    this.socket.emit(messageType, {\n      socketID: this.socket.id,\n      payload,\n    });\n  };\n\n  createOffer = () => {\n    console.log(\"Offer\");\n    this.pc.createOffer({ offerToReceiveVideo: 1 }).then((sdp) => {\n      this.pc.setLocalDescription(sdp);\n      this.sendToPeer(\"offerOrAnswer\", sdp);\n    });\n  };\n\n  /* setRemoteDescription = () => {\n    const desc = JSON.parse(this.textref);\n\n    this.pc.setRemoteDescription(new RTCSessionDescription(desc));\n  }; */\n\n  setRemoteDescription = () => {\n    // retrieve and parse the SDP copied from the remote peer\n    const desc = JSON.parse(this.textref.value);\n\n    // set sdp as remote description\n    this.pc.setRemoteDescription(new RTCSessionDescription(desc));\n  };\n\n  createAnswer = () => {\n    console.log(\"Answer\");\n    this.pc.createAnswer({ offerToReceiveVideo: 1 }).then((sdp) => {\n      this.pc.setLocalDescription(sdp);\n      this.sendToPeer(\"offerOrAnswer\", sdp);\n    });\n  };\n\n  addCandidate = () => {\n    /* const candidate = JSON.parse(this.textref.value);\n    console.log(\"Adding candidate:\", candidate);\n\n    this.pc.addIceCandidate(new RTCIceCandidate(candidate)); */\n    this.candidates.forEach((candidate) => {\n      console.log(JSON.stringify(candidate));\n      this.pc.addIceCandidate(new RTCIceCandidate(candidate));\n    });\n  };\n\n  render() {\n    return (\n      <div>\n        <video\n          style={{\n            width: 240,\n            height: 240,\n            margin: 5,\n            backgroundColor: \"black\",\n          }}\n          ref={this.localVideoRef}\n          autoPlay\n        ></video>\n        <video\n          style={{\n            width: 240,\n            height: 240,\n            margin: 5,\n            backgroundColor: \"black\",\n          }}\n          ref={this.remoteVideoRef}\n          autoPlay\n        ></video>\n\n        <button onClick={this.createOffer}>Offer</button>\n        <button onClick={this.createAnswer}>Answer</button>\n        <br />\n        <textarea\n          style={{ width: 450, height: 40 }}\n          ref={(ref) => {\n            this.textref = ref;\n          }}\n        />\n        <br />\n        <button onClick={this.setRemoteDescription}>\n          Set remote description\n        </button>\n        <button onClick={this.addCandidate}>Add cadidate</button>\n      </div>\n    );\n  }\n  /* render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <h1 className=\"App-title\"> Welcome to React </h1>\n        </header>\n        <PeerConnection />\n      </div>\n    );\n  } */\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}