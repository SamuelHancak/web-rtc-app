{"ast":null,"code":"import _toConsumableArray from\"/Users/samuelhancak/Documents/WebRTC/web-rtc-audio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"/Users/samuelhancak/Documents/WebRTC/web-rtc-audio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/samuelhancak/Documents/WebRTC/web-rtc-audio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/Users/samuelhancak/Documents/WebRTC/web-rtc-audio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/samuelhancak/Documents/WebRTC/web-rtc-audio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/samuelhancak/Documents/WebRTC/web-rtc-audio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/samuelhancak/Documents/WebRTC/web-rtc-audio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";// import React, { Component } from \"react\";\n// import io from \"socket.io-client\";\n// import Video from \"./components/video\";\n// import Videos from \"./components/videos\";\n// class App extends Component {\n//   constructor(props) {\n//     super(props);\n//     this.state = {\n//       localStream: null, // used to hold local stream object to avoid recreating the stream everytime a new offer comes\n//       remoteStream: null, // used to hold remote stream object that is displayed in the main screen\n//       remoteStreams: [], // holds all Video Streams (all remote streams)\n//       peerConnections: {}, // holds all Peer Connections\n//       selectedVideo: null,\n//       muted: true,\n//       status: \"Please wait...\",\n//       pc_config: {\n//         iceServers: [\n//           {\n//             urls: \"turn:numb.viagenie.ca\",\n//             credential: \"Cristiano741258\",\n//             username: \"sam2323@azet.sk\",\n//           },\n//           {\n//             urls: \"stun:stun.l.google.com:19302\",\n//           },\n//         ],\n//       },\n//       sdpConstraints: {\n//         mandatory: {\n//           OfferToReceiveAudio: true,\n//           OfferToReceiveVideo: true,\n//         },\n//       },\n//     };\n//     this.socket = null;\n//     // this.candidates = []\n//   }\n//   getLocalStream = () => {\n//     // called when getUserMedia() successfully returns - see below\n//     // getUserMedia() returns a MediaStream object (https://developer.mozilla.org/en-US/docs/Web/API/MediaStream)\n//     const success = (stream) => {\n//       window.localStream = stream;\n//       // this.localVideoref.current.srcObject = stream\n//       // this.pc.addStream(stream);\n//       this.setState({\n//         localStream: stream,\n//       });\n//       this.whoisOnline();\n//     };\n//     // called when getUserMedia() fails - see below\n//     const failure = (e) => {\n//       console.log(\"getUserMedia Error: \", e);\n//     };\n//     // https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n//     // see the above link for more constraint options\n//     const constraints = {\n//       audio: true,\n//       video: true,\n//       // video: {\n//       //   width: 1280,\n//       //   height: 720\n//       // },\n//       // video: {\n//       //   width: { min: 1280 },\n//       // }\n//       options: {\n//         mirror: true,\n//       },\n//     };\n//     // https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n//     navigator.mediaDevices\n//       .getUserMedia(constraints)\n//       .then(success)\n//       .catch(failure);\n//   };\n//   whoisOnline = () => {\n//     // let all peers know I am joining\n//     this.sendToPeer(\"onlinePeers\", null, { local: this.socket.id });\n//   };\n//   sendToPeer = (messageType, payload, socketID) => {\n//     this.socket.emit(messageType, {\n//       socketID,\n//       payload,\n//     });\n//   };\n//   createPeerConnection = (socketID, callback) => {\n//     try {\n//       let pc = new RTCPeerConnection(this.state.pc_config);\n//       // add pc to peerConnections object\n//       const peerConnections = { ...this.state.peerConnections, [socketID]: pc };\n//       this.setState({\n//         peerConnections,\n//       });\n//       pc.onicecandidate = (e) => {\n//         if (e.candidate) {\n//           this.sendToPeer(\"candidate\", e.candidate, {\n//             local: this.socket.id,\n//             remote: socketID,\n//           });\n//         }\n//       };\n//       pc.oniceconnectionstatechange = (e) => {};\n//       pc.ontrack = (e) => {\n//         const remoteVideo = {\n//           id: socketID,\n//           name: socketID,\n//           stream: e.streams[0],\n//         };\n//         this.setState((prevState) => {\n//           // If we already have a stream in display let it stay the same, otherwise use the latest stream\n//           const remoteStream =\n//             prevState.remoteStreams.length > 0\n//               ? {}\n//               : { remoteStream: e.streams[0] };\n//           // get currently selected video\n//           let selectedVideo = prevState.remoteStreams.filter(\n//             (stream) => stream.id === prevState.selectedVideo.id\n//           );\n//           // if the video is still in the list, then do nothing, otherwise set to new video stream\n//           selectedVideo = selectedVideo.length\n//             ? {}\n//             : { selectedVideo: remoteVideo };\n//           return {\n//             // selectedVideo: remoteVideo,\n//             ...selectedVideo,\n//             // remoteStream: e.streams[0],\n//             ...remoteStream,\n//             remoteStreams: [...prevState.remoteStreams, remoteVideo],\n//           };\n//         });\n//       };\n//       pc.close = () => {\n//         // alert('GONE')\n//       };\n//       if (this.state.localStream) pc.addStream(this.state.localStream);\n//       // return pc\n//       callback(pc);\n//     } catch (e) {\n//       console.log(\"Something went wrong! pc not created!!\", e);\n//       // return;\n//       callback(null);\n//     }\n//   };\n//   componentDidMount = () => {\n//     this.socket = io.connect(\"https://8beb319d.ngrok.io/webrtcPeer\", {\n//       path: \"/io/web-rtc-audio\",\n//       query: {\n//         room: window.location.pathname,\n//       },\n//     });\n//     this.socket.on(\"connection-success\", (data) => {\n//       this.getLocalStream();\n//       console.log(data.success);\n//       const status =\n//         data.peerCount > 1\n//           ? `Total Connected Peers to room ${window.location.pathname}: ${data.peerCount}`\n//           : \"Waiting for other peers to connect\";\n//       this.setState({\n//         status: status,\n//       });\n//     });\n//     this.socket.on(\"joined-peers\", (data) => {\n//       this.setState({\n//         status:\n//           data.peerCount > 1\n//             ? `Total Connected Peers to room ${window.location.pathname}: ${data.peerCount}`\n//             : \"Waiting for other peers to connect\",\n//       });\n//     });\n//     this.socket.on(\"peer-disconnected\", (data) => {\n//       console.log(\"peer-disconnected\", data);\n//       const remoteStreams = this.state.remoteStreams.filter(\n//         (stream) => stream.id !== data.socketID\n//       );\n//       this.setState((prevState) => {\n//         // check if disconnected peer is the selected video and if there still connected peers, then select the first\n//         const selectedVideo =\n//           prevState.selectedVideo.id === data.socketID && remoteStreams.length\n//             ? { selectedVideo: remoteStreams[0] }\n//             : null;\n//         return {\n//           // remoteStream: remoteStreams.length > 0 && remoteStreams[0].stream || null,\n//           remoteStreams,\n//           ...selectedVideo,\n//           status:\n//             data.peerCount > 1\n//               ? `Total Connected Peers to room ${window.location.pathname}: ${data.peerCount}`\n//               : \"Waiting for other peers to connect\",\n//         };\n//       });\n//     });\n//     this.socket.on(\"online-peer\", (socketID) => {\n//       console.log(\"connected peers ...\", socketID);\n//       // create and send offer to the peer (data.socketID)\n//       // 1. Create new pc\n//       this.createPeerConnection(socketID, (pc) => {\n//         // 2. Create Offer\n//         if (pc)\n//           pc.createOffer(this.state.sdpConstraints).then((sdp) => {\n//             pc.setLocalDescription(sdp);\n//             console.log(\"offer\", new Date());\n//             this.sendToPeer(\"offer\", sdp, {\n//               local: this.socket.id,\n//               remote: socketID,\n//             });\n//           });\n//       });\n//     });\n//     this.socket.on(\"offer\", (data) => {\n//       this.createPeerConnection(data.socketID, (pc) => {\n//         pc.addStream(this.state.localStream);\n//         pc.setRemoteDescription(new RTCSessionDescription(data.sdp)).then(\n//           () => {\n//             // 2. Create Answer\n//             pc.createAnswer(this.state.sdpConstraints).then((sdp) => {\n//               pc.setLocalDescription(sdp);\n//               this.sendToPeer(\"answer\", sdp, {\n//                 local: this.socket.id,\n//                 remote: data.socketID,\n//               });\n//             });\n//           }\n//         );\n//       });\n//     });\n//     this.socket.on(\"answer\", (data) => {\n//       // get remote's peerConnection\n//       const pc = this.state.peerConnections[data.socketID];\n//       console.log(data.sdp);\n//       console.log(\"answer\", new Date());\n//       pc.setRemoteDescription(\n//         new RTCSessionDescription(data.sdp)\n//       ).then(() => {});\n//     });\n//     this.socket.on(\"candidate\", (data) => {\n//       // get remote's peerConnection\n//       const pc = this.state.peerConnections[data.socketID];\n//       if (pc) pc.addIceCandidate(new RTCIceCandidate(data.candidate));\n//     });\n//   };\n//   switchVideo = (_video) => {\n//     console.log(_video);\n//     this.setState({\n//       selectedVideo: _video,\n//     });\n//   };\n//   render() {\n//     console.log(this.state.localStream);\n//     const statusText = (\n//       <div style={{ color: \"yellow\", padding: 5 }}>{this.state.status}</div>\n//     );\n//     return (\n//       <div>\n//         <Video\n//           videoStyles={{\n//             zIndex: 2,\n//             position: \"absolute\",\n//             right: 0,\n//             width: 200,\n//             height: 200,\n//             margin: 5,\n//             backgroundColor: \"black\",\n//           }}\n//           videoStream={this.state.localStream}\n//           autoPlay\n//           muted\n//         ></Video>\n//         <Video\n//           videoStyles={{\n//             zIndex: 1,\n//             position: \"fixed\",\n//             bottom: 0,\n//             minWidth: \"100%\",\n//             minHeight: \"100%\",\n//             backgroundColor: \"black\",\n//           }}\n//           videoStream={\n//             this.state.selectedVideo && this.state.selectedVideo.stream\n//           }\n//           autoPlay\n//           muted\n//         ></Video>\n//         <br />\n//         <div\n//           style={{\n//             zIndex: 3,\n//             position: \"absolute\",\n//             margin: 10,\n//             backgroundColor: \"#cdc4ff4f\",\n//             padding: 10,\n//             borderRadius: 5,\n//           }}\n//         >\n//           {statusText}\n//         </div>\n//         {/* <div\n//           style={{\n//             zIndex: 5,\n//             position: \"absolute\",\n//             margin: 10,\n//           }}\n//         >\n//           <button onClick={() => this.muted}>Push to talk</button>\n//         </div> */}\n//         <div>\n//           <Videos\n//             switchVideo={this.switchVideo}\n//             remoteStreams={this.state.remoteStreams}\n//           ></Videos>\n//         </div>\n//         <br />\n//       </div>\n//     );\n//   }\n// }\n// export default App;\nimport React,{Component}from\"react\";import io from\"socket.io-client\";import Video from\"./components/video\";import Videos from\"./components/videos\";var App=/*#__PURE__*/function(_Component){_inherits(App,_Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.getLocalStream=function(){// called when getUserMedia() successfully returns - see below\n// getUserMedia() returns a MediaStream object (https://developer.mozilla.org/en-US/docs/Web/API/MediaStream)\nvar success=function success(stream){window.localStream=stream;audioTracks=stream.getAudioTracks();_this.setState({localStream:stream});_this.whoisOnline();};// called when getUserMedia() fails - see below\nvar failure=function failure(e){console.log(\"getUserMedia Error: \",e);};// if MediaStream has reference to microphone\nif(audioTracks[0]){audioTracks[0].enabled=_this.state.mute;}// https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n// see the above link for more constraint options\nvar constraints={audio:true,video:true,// video: {\n//   width: 1280,\n//   height: 720\n// },\n// video: {\n//   width: { min: 1280 },\n// }\noptions:{mirror:true}};// https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\nnavigator.mediaDevices.getUserMedia(constraints).then(success).catch(failure);};_this.whoisOnline=function(){// let all peers know I am joining\n_this.sendToPeer(\"onlinePeers\",null,{local:_this.socket.id});};_this.sendToPeer=function(messageType,payload,socketID){_this.socket.emit(messageType,{socketID:socketID,payload:payload});};_this.createPeerConnection=function(socketID,callback){try{var pc=new RTCPeerConnection(_this.state.pc_config);// add pc to peerConnections object\nvar peerConnections=_objectSpread(_objectSpread({},_this.state.peerConnections),{},_defineProperty({},socketID,pc));_this.setState({peerConnections:peerConnections});pc.onicecandidate=function(e){if(e.candidate){_this.sendToPeer(\"candidate\",e.candidate,{local:_this.socket.id,remote:socketID});}};pc.oniceconnectionstatechange=function(e){// if (pc.iceConnectionState === 'disconnected') {\n//   const remoteStreams = this.state.remoteStreams.filter(stream => stream.id !== socketID)\n//   this.setState({\n//     remoteStream: remoteStreams.length > 0 && remoteStreams[0].stream || null,\n//   })\n// }\n};pc.ontrack=function(e){var remoteVideo={id:socketID,name:socketID,stream:e.streams[0]};_this.setState(function(prevState){// If we already have a stream in display let it stay the same, otherwise use the latest stream\nvar remoteStream=prevState.remoteStreams.length>0?{}:{remoteStream:e.streams[0]};// get currently selected video\nvar selectedVideo=prevState.remoteStreams.filter(function(stream){return stream.id===prevState.selectedVideo.id;});// if the video is still in the list, then do nothing, otherwise set to new video stream\nselectedVideo=selectedVideo.length?{}:{selectedVideo:remoteVideo};return _objectSpread(_objectSpread(_objectSpread({},selectedVideo),remoteStream),{},{remoteStreams:[].concat(_toConsumableArray(prevState.remoteStreams),[remoteVideo])});});};pc.close=function(){// alert('GONE')\n};if(_this.state.localStream)pc.addStream(_this.state.localStream);// return pc\ncallback(pc);}catch(e){console.log(\"Something went wrong! pc not created!!\",e);// return;\ncallback(null);}};_this.componentDidMount=function(){_this.socket=io.connect(\"https://1b8c802c.ngrok.io/webrtcPeer\",{path:\"/io/web-rtc-audio\",query:{}});_this.socket.on(\"connection-success\",function(data){_this.getLocalStream();console.log(data.success);var status=data.peerCount>1?\"Total Connected Peers: \".concat(data.peerCount):\"Waiting for other peers to connect\";_this.setState({status:status});});_this.socket.on(\"peer-disconnected\",function(data){console.log(\"peer-disconnected\",data);var remoteStreams=_this.state.remoteStreams.filter(function(stream){return stream.id!==data.socketID;});_this.setState(function(prevState){// check if disconnected peer is the selected video and if there still connected peers, then select the first\nvar selectedVideo=prevState.selectedVideo.id===data.socketID&&remoteStreams.length?{selectedVideo:remoteStreams[0]}:null;return _objectSpread({// remoteStream: remoteStreams.length > 0 && remoteStreams[0].stream || null,\nremoteStreams:remoteStreams},selectedVideo);});});// this.socket.on('offerOrAnswer', (sdp) => {\n//   this.textref.value = JSON.stringify(sdp)\n//   // set sdp as remote description\n//   this.pc.setRemoteDescription(new RTCSessionDescription(sdp))\n// })\n_this.socket.on(\"online-peer\",function(socketID){console.log(\"connected peers ...\",socketID);// create and send offer to the peer (data.socketID)\n// 1. Create new pc\n_this.createPeerConnection(socketID,function(pc){// 2. Create Offer\nif(pc)pc.createOffer(_this.state.sdpConstraints).then(function(sdp){pc.setLocalDescription(sdp);_this.sendToPeer(\"offer\",sdp,{local:_this.socket.id,remote:socketID});});});});_this.socket.on(\"offer\",function(data){_this.createPeerConnection(data.socketID,function(pc){pc.addStream(_this.state.localStream);pc.setRemoteDescription(new RTCSessionDescription(data.sdp)).then(function(){// 2. Create Answer\npc.createAnswer(_this.state.sdpConstraints).then(function(sdp){pc.setLocalDescription(sdp);_this.sendToPeer(\"answer\",sdp,{local:_this.socket.id,remote:data.socketID});});});});});_this.socket.on(\"answer\",function(data){// get remote's peerConnection\nvar pc=_this.state.peerConnections[data.socketID];console.log(data.sdp);pc.setRemoteDescription(new RTCSessionDescription(data.sdp)).then(function(){});});_this.socket.on(\"candidate\",function(data){// get remote's peerConnection\nvar pc=_this.state.peerConnections[data.socketID];if(pc)pc.addIceCandidate(new RTCIceCandidate(data.candidate));});};_this.switchVideo=function(_video){console.log(_video);_this.setState({selectedVideo:_video});};var _audioTracks;_this.state={localStream:null,// used to hold local stream object to avoid recreating the stream everytime a new offer comes\nremoteStream:null,// used to hold remote stream object that is displayed in the main screen\nmute:true,remoteStreams:[],// holds all Video Streams (all remote streams)\npeerConnections:{},// holds all Peer Connections\nselectedVideo:null,status:\"Please wait...\",pc_config:{iceServers:[{urls:\"turn:numb.viagenie.ca\",credential:\"Cristiano741258\",username:\"sam2323@azet.sk\"},{urls:\"stun:stun.l.google.com:19302\"}]},sdpConstraints:{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:true}}};// DONT FORGET TO CHANGE TO YOUR URL\n//this.serviceIP = \"https://8beb319d.ngrok.io/webrtcPeer\";\n// https://reactjs.org/docs/refs-and-the-dom.html\n// this.localVideoref = React.createRef()\n// this.remoteVideoref = React.createRef()\n_this.socket=null;// this.candidates = []\nreturn _this;}_createClass(App,[{key:\"render\",value:function render(){var _this2=this;console.log(this.state.localStream);var statusText=/*#__PURE__*/React.createElement(\"div\",{style:{color:\"yellow\",padding:5}},this.state.status);return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Video,{videoStyles:{zIndex:2,position:\"absolute\",right:0,width:200,height:200,margin:5,backgroundColor:\"black\"}// ref={this.localVideoref}\n,videoStream:this.state.localStream,autoPlay:true,muted:true}),/*#__PURE__*/React.createElement(Video,{videoStyles:{zIndex:1,position:\"fixed\",bottom:0,minWidth:\"100%\",minHeight:\"100%\",backgroundColor:\"black\"}// ref={ this.remoteVideoref }\n,videoStream:this.state.selectedVideo&&this.state.selectedVideo.stream,autoPlay:true//muted={this.state.muted}\n}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"div\",{style:{zIndex:3,position:\"absolute\",margin:10,backgroundColor:\"#cdc4ff4f\",padding:10,borderRadius:5}},statusText),/*#__PURE__*/React.createElement(\"div\",{style:{zIndex:5,position:\"absolute\",margin:10,right:10,bottom:120}},/*#__PURE__*/React.createElement(\"button\",{onMouseDown:function onMouseDown(){return _this2.setState({mute:false});},onMouseUp:function onMouseUp(){return _this2.setState({mute:true});}},\"Push to talk\")),/*#__PURE__*/React.createElement(\"br\",null));}}]);return App;}(Component);export default App;","map":{"version":3,"sources":["/Users/samuelhancak/Documents/WebRTC/web-rtc-audio/src/App.js"],"names":["React","Component","io","Video","Videos","App","props","getLocalStream","success","stream","window","localStream","audioTracks","getAudioTracks","setState","whoisOnline","failure","e","console","log","enabled","state","mute","constraints","audio","video","options","mirror","navigator","mediaDevices","getUserMedia","then","catch","sendToPeer","local","socket","id","messageType","payload","socketID","emit","createPeerConnection","callback","pc","RTCPeerConnection","pc_config","peerConnections","onicecandidate","candidate","remote","oniceconnectionstatechange","ontrack","remoteVideo","name","streams","prevState","remoteStream","remoteStreams","length","selectedVideo","filter","close","addStream","componentDidMount","connect","path","query","on","data","status","peerCount","createOffer","sdpConstraints","sdp","setLocalDescription","setRemoteDescription","RTCSessionDescription","createAnswer","addIceCandidate","RTCIceCandidate","switchVideo","_video","iceServers","urls","credential","username","mandatory","OfferToReceiveAudio","OfferToReceiveVideo","statusText","color","padding","zIndex","position","right","width","height","margin","backgroundColor","bottom","minWidth","minHeight","borderRadius"],"mappings":"wpCAAA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAC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","sourcesContent":["// import React, { Component } from \"react\";\n\n// import io from \"socket.io-client\";\n\n// import Video from \"./components/video\";\n// import Videos from \"./components/videos\";\n\n// class App extends Component {\n//   constructor(props) {\n//     super(props);\n\n//     this.state = {\n//       localStream: null, // used to hold local stream object to avoid recreating the stream everytime a new offer comes\n//       remoteStream: null, // used to hold remote stream object that is displayed in the main screen\n\n//       remoteStreams: [], // holds all Video Streams (all remote streams)\n//       peerConnections: {}, // holds all Peer Connections\n//       selectedVideo: null,\n\n//       muted: true,\n\n//       status: \"Please wait...\",\n\n//       pc_config: {\n//         iceServers: [\n//           {\n//             urls: \"turn:numb.viagenie.ca\",\n//             credential: \"Cristiano741258\",\n//             username: \"sam2323@azet.sk\",\n//           },\n//           {\n//             urls: \"stun:stun.l.google.com:19302\",\n//           },\n//         ],\n//       },\n\n//       sdpConstraints: {\n//         mandatory: {\n//           OfferToReceiveAudio: true,\n//           OfferToReceiveVideo: true,\n//         },\n//       },\n//     };\n\n//     this.socket = null;\n//     // this.candidates = []\n//   }\n\n//   getLocalStream = () => {\n//     // called when getUserMedia() successfully returns - see below\n//     // getUserMedia() returns a MediaStream object (https://developer.mozilla.org/en-US/docs/Web/API/MediaStream)\n//     const success = (stream) => {\n//       window.localStream = stream;\n//       // this.localVideoref.current.srcObject = stream\n//       // this.pc.addStream(stream);\n//       this.setState({\n//         localStream: stream,\n//       });\n\n//       this.whoisOnline();\n//     };\n\n//     // called when getUserMedia() fails - see below\n//     const failure = (e) => {\n//       console.log(\"getUserMedia Error: \", e);\n//     };\n\n//     // https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n//     // see the above link for more constraint options\n//     const constraints = {\n//       audio: true,\n//       video: true,\n//       // video: {\n//       //   width: 1280,\n//       //   height: 720\n//       // },\n//       // video: {\n//       //   width: { min: 1280 },\n//       // }\n//       options: {\n//         mirror: true,\n//       },\n//     };\n\n//     // https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n//     navigator.mediaDevices\n//       .getUserMedia(constraints)\n//       .then(success)\n//       .catch(failure);\n//   };\n\n//   whoisOnline = () => {\n//     // let all peers know I am joining\n//     this.sendToPeer(\"onlinePeers\", null, { local: this.socket.id });\n//   };\n\n//   sendToPeer = (messageType, payload, socketID) => {\n//     this.socket.emit(messageType, {\n//       socketID,\n//       payload,\n//     });\n//   };\n\n//   createPeerConnection = (socketID, callback) => {\n//     try {\n//       let pc = new RTCPeerConnection(this.state.pc_config);\n\n//       // add pc to peerConnections object\n//       const peerConnections = { ...this.state.peerConnections, [socketID]: pc };\n//       this.setState({\n//         peerConnections,\n//       });\n\n//       pc.onicecandidate = (e) => {\n//         if (e.candidate) {\n//           this.sendToPeer(\"candidate\", e.candidate, {\n//             local: this.socket.id,\n//             remote: socketID,\n//           });\n//         }\n//       };\n\n//       pc.oniceconnectionstatechange = (e) => {};\n\n//       pc.ontrack = (e) => {\n//         const remoteVideo = {\n//           id: socketID,\n//           name: socketID,\n//           stream: e.streams[0],\n//         };\n\n//         this.setState((prevState) => {\n//           // If we already have a stream in display let it stay the same, otherwise use the latest stream\n//           const remoteStream =\n//             prevState.remoteStreams.length > 0\n//               ? {}\n//               : { remoteStream: e.streams[0] };\n\n//           // get currently selected video\n//           let selectedVideo = prevState.remoteStreams.filter(\n//             (stream) => stream.id === prevState.selectedVideo.id\n//           );\n//           // if the video is still in the list, then do nothing, otherwise set to new video stream\n//           selectedVideo = selectedVideo.length\n//             ? {}\n//             : { selectedVideo: remoteVideo };\n\n//           return {\n//             // selectedVideo: remoteVideo,\n//             ...selectedVideo,\n//             // remoteStream: e.streams[0],\n//             ...remoteStream,\n//             remoteStreams: [...prevState.remoteStreams, remoteVideo],\n//           };\n//         });\n//       };\n\n//       pc.close = () => {\n//         // alert('GONE')\n//       };\n\n//       if (this.state.localStream) pc.addStream(this.state.localStream);\n\n//       // return pc\n//       callback(pc);\n//     } catch (e) {\n//       console.log(\"Something went wrong! pc not created!!\", e);\n//       // return;\n//       callback(null);\n//     }\n//   };\n\n//   componentDidMount = () => {\n//     this.socket = io.connect(\"https://8beb319d.ngrok.io/webrtcPeer\", {\n//       path: \"/io/web-rtc-audio\",\n//       query: {\n//         room: window.location.pathname,\n//       },\n//     });\n\n//     this.socket.on(\"connection-success\", (data) => {\n//       this.getLocalStream();\n\n//       console.log(data.success);\n//       const status =\n//         data.peerCount > 1\n//           ? `Total Connected Peers to room ${window.location.pathname}: ${data.peerCount}`\n//           : \"Waiting for other peers to connect\";\n\n//       this.setState({\n//         status: status,\n//       });\n//     });\n\n//     this.socket.on(\"joined-peers\", (data) => {\n//       this.setState({\n//         status:\n//           data.peerCount > 1\n//             ? `Total Connected Peers to room ${window.location.pathname}: ${data.peerCount}`\n//             : \"Waiting for other peers to connect\",\n//       });\n//     });\n\n//     this.socket.on(\"peer-disconnected\", (data) => {\n//       console.log(\"peer-disconnected\", data);\n\n//       const remoteStreams = this.state.remoteStreams.filter(\n//         (stream) => stream.id !== data.socketID\n//       );\n\n//       this.setState((prevState) => {\n//         // check if disconnected peer is the selected video and if there still connected peers, then select the first\n//         const selectedVideo =\n//           prevState.selectedVideo.id === data.socketID && remoteStreams.length\n//             ? { selectedVideo: remoteStreams[0] }\n//             : null;\n\n//         return {\n//           // remoteStream: remoteStreams.length > 0 && remoteStreams[0].stream || null,\n//           remoteStreams,\n//           ...selectedVideo,\n//           status:\n//             data.peerCount > 1\n//               ? `Total Connected Peers to room ${window.location.pathname}: ${data.peerCount}`\n//               : \"Waiting for other peers to connect\",\n//         };\n//       });\n//     });\n\n//     this.socket.on(\"online-peer\", (socketID) => {\n//       console.log(\"connected peers ...\", socketID);\n\n//       // create and send offer to the peer (data.socketID)\n//       // 1. Create new pc\n//       this.createPeerConnection(socketID, (pc) => {\n//         // 2. Create Offer\n//         if (pc)\n//           pc.createOffer(this.state.sdpConstraints).then((sdp) => {\n//             pc.setLocalDescription(sdp);\n//             console.log(\"offer\", new Date());\n\n//             this.sendToPeer(\"offer\", sdp, {\n//               local: this.socket.id,\n//               remote: socketID,\n//             });\n//           });\n//       });\n//     });\n\n//     this.socket.on(\"offer\", (data) => {\n//       this.createPeerConnection(data.socketID, (pc) => {\n//         pc.addStream(this.state.localStream);\n\n//         pc.setRemoteDescription(new RTCSessionDescription(data.sdp)).then(\n//           () => {\n//             // 2. Create Answer\n//             pc.createAnswer(this.state.sdpConstraints).then((sdp) => {\n//               pc.setLocalDescription(sdp);\n\n//               this.sendToPeer(\"answer\", sdp, {\n//                 local: this.socket.id,\n//                 remote: data.socketID,\n//               });\n//             });\n//           }\n//         );\n//       });\n//     });\n\n//     this.socket.on(\"answer\", (data) => {\n//       // get remote's peerConnection\n//       const pc = this.state.peerConnections[data.socketID];\n//       console.log(data.sdp);\n//       console.log(\"answer\", new Date());\n\n//       pc.setRemoteDescription(\n//         new RTCSessionDescription(data.sdp)\n//       ).then(() => {});\n//     });\n\n//     this.socket.on(\"candidate\", (data) => {\n//       // get remote's peerConnection\n//       const pc = this.state.peerConnections[data.socketID];\n\n//       if (pc) pc.addIceCandidate(new RTCIceCandidate(data.candidate));\n//     });\n//   };\n\n//   switchVideo = (_video) => {\n//     console.log(_video);\n//     this.setState({\n//       selectedVideo: _video,\n//     });\n//   };\n\n//   render() {\n//     console.log(this.state.localStream);\n\n//     const statusText = (\n//       <div style={{ color: \"yellow\", padding: 5 }}>{this.state.status}</div>\n//     );\n\n//     return (\n//       <div>\n//         <Video\n//           videoStyles={{\n//             zIndex: 2,\n//             position: \"absolute\",\n//             right: 0,\n//             width: 200,\n//             height: 200,\n//             margin: 5,\n//             backgroundColor: \"black\",\n//           }}\n//           videoStream={this.state.localStream}\n//           autoPlay\n//           muted\n//         ></Video>\n//         <Video\n//           videoStyles={{\n//             zIndex: 1,\n//             position: \"fixed\",\n//             bottom: 0,\n//             minWidth: \"100%\",\n//             minHeight: \"100%\",\n//             backgroundColor: \"black\",\n//           }}\n//           videoStream={\n//             this.state.selectedVideo && this.state.selectedVideo.stream\n//           }\n//           autoPlay\n//           muted\n//         ></Video>\n//         <br />\n//         <div\n//           style={{\n//             zIndex: 3,\n//             position: \"absolute\",\n//             margin: 10,\n//             backgroundColor: \"#cdc4ff4f\",\n//             padding: 10,\n//             borderRadius: 5,\n//           }}\n//         >\n//           {statusText}\n//         </div>\n\n//         {/* <div\n//           style={{\n//             zIndex: 5,\n//             position: \"absolute\",\n//             margin: 10,\n//           }}\n//         >\n//           <button onClick={() => this.muted}>Push to talk</button>\n//         </div> */}\n\n//         <div>\n//           <Videos\n//             switchVideo={this.switchVideo}\n//             remoteStreams={this.state.remoteStreams}\n//           ></Videos>\n//         </div>\n//         <br />\n//       </div>\n//     );\n//   }\n// }\n\n// export default App;\n\nimport React, { Component } from \"react\";\n\nimport io from \"socket.io-client\";\n\nimport Video from \"./components/video\";\nimport Videos from \"./components/videos\";\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    var audioTracks;\n\n    this.state = {\n      localStream: null, // used to hold local stream object to avoid recreating the stream everytime a new offer comes\n      remoteStream: null, // used to hold remote stream object that is displayed in the main screen\n\n      mute: true,\n\n      remoteStreams: [], // holds all Video Streams (all remote streams)\n      peerConnections: {}, // holds all Peer Connections\n      selectedVideo: null,\n\n      status: \"Please wait...\",\n\n      pc_config: {\n        iceServers: [\n          {\n            urls: \"turn:numb.viagenie.ca\",\n            credential: \"Cristiano741258\",\n            username: \"sam2323@azet.sk\",\n          },\n          {\n            urls: \"stun:stun.l.google.com:19302\",\n          },\n        ],\n      },\n\n      sdpConstraints: {\n        mandatory: {\n          OfferToReceiveAudio: true,\n          OfferToReceiveVideo: true,\n        },\n      },\n    };\n\n    // DONT FORGET TO CHANGE TO YOUR URL\n    //this.serviceIP = \"https://8beb319d.ngrok.io/webrtcPeer\";\n\n    // https://reactjs.org/docs/refs-and-the-dom.html\n    // this.localVideoref = React.createRef()\n    // this.remoteVideoref = React.createRef()\n\n    this.socket = null;\n    // this.candidates = []\n  }\n\n  getLocalStream = () => {\n    // called when getUserMedia() successfully returns - see below\n    // getUserMedia() returns a MediaStream object (https://developer.mozilla.org/en-US/docs/Web/API/MediaStream)\n    const success = (stream) => {\n      window.localStream = stream;\n      audioTracks = stream.getAudioTracks();\n      this.setState({\n        localStream: stream,\n      });\n\n      this.whoisOnline();\n    };\n\n    // called when getUserMedia() fails - see below\n    const failure = (e) => {\n      console.log(\"getUserMedia Error: \", e);\n    };\n\n    // if MediaStream has reference to microphone\n    if (audioTracks[0]) {\n      audioTracks[0].enabled = this.state.mute;\n    }\n\n    // https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n    // see the above link for more constraint options\n    const constraints = {\n      audio: true,\n      video: true,\n      // video: {\n      //   width: 1280,\n      //   height: 720\n      // },\n      // video: {\n      //   width: { min: 1280 },\n      // }\n      options: {\n        mirror: true,\n      },\n    };\n\n    // https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n    navigator.mediaDevices\n      .getUserMedia(constraints)\n      .then(success)\n      .catch(failure);\n  };\n\n  whoisOnline = () => {\n    // let all peers know I am joining\n    this.sendToPeer(\"onlinePeers\", null, { local: this.socket.id });\n  };\n\n  sendToPeer = (messageType, payload, socketID) => {\n    this.socket.emit(messageType, {\n      socketID,\n      payload,\n    });\n  };\n\n  createPeerConnection = (socketID, callback) => {\n    try {\n      let pc = new RTCPeerConnection(this.state.pc_config);\n\n      // add pc to peerConnections object\n      const peerConnections = { ...this.state.peerConnections, [socketID]: pc };\n      this.setState({\n        peerConnections,\n      });\n\n      pc.onicecandidate = (e) => {\n        if (e.candidate) {\n          this.sendToPeer(\"candidate\", e.candidate, {\n            local: this.socket.id,\n            remote: socketID,\n          });\n        }\n      };\n\n      pc.oniceconnectionstatechange = (e) => {\n        // if (pc.iceConnectionState === 'disconnected') {\n        //   const remoteStreams = this.state.remoteStreams.filter(stream => stream.id !== socketID)\n        //   this.setState({\n        //     remoteStream: remoteStreams.length > 0 && remoteStreams[0].stream || null,\n        //   })\n        // }\n      };\n\n      pc.ontrack = (e) => {\n        const remoteVideo = {\n          id: socketID,\n          name: socketID,\n          stream: e.streams[0],\n        };\n\n        this.setState((prevState) => {\n          // If we already have a stream in display let it stay the same, otherwise use the latest stream\n          const remoteStream =\n            prevState.remoteStreams.length > 0\n              ? {}\n              : { remoteStream: e.streams[0] };\n\n          // get currently selected video\n          let selectedVideo = prevState.remoteStreams.filter(\n            (stream) => stream.id === prevState.selectedVideo.id\n          );\n          // if the video is still in the list, then do nothing, otherwise set to new video stream\n          selectedVideo = selectedVideo.length\n            ? {}\n            : { selectedVideo: remoteVideo };\n\n          return {\n            // selectedVideo: remoteVideo,\n            ...selectedVideo,\n            // remoteStream: e.streams[0],\n            ...remoteStream,\n            remoteStreams: [...prevState.remoteStreams, remoteVideo],\n          };\n        });\n      };\n\n      pc.close = () => {\n        // alert('GONE')\n      };\n\n      if (this.state.localStream) pc.addStream(this.state.localStream);\n\n      // return pc\n      callback(pc);\n    } catch (e) {\n      console.log(\"Something went wrong! pc not created!!\", e);\n      // return;\n      callback(null);\n    }\n  };\n\n  componentDidMount = () => {\n    this.socket = io.connect(\"https://1b8c802c.ngrok.io/webrtcPeer\", {\n      path: \"/io/web-rtc-audio\",\n      query: {},\n    });\n\n    this.socket.on(\"connection-success\", (data) => {\n      this.getLocalStream();\n\n      console.log(data.success);\n      const status =\n        data.peerCount > 1\n          ? `Total Connected Peers: ${data.peerCount}`\n          : \"Waiting for other peers to connect\";\n\n      this.setState({\n        status: status,\n      });\n    });\n\n    this.socket.on(\"peer-disconnected\", (data) => {\n      console.log(\"peer-disconnected\", data);\n\n      const remoteStreams = this.state.remoteStreams.filter(\n        (stream) => stream.id !== data.socketID\n      );\n\n      this.setState((prevState) => {\n        // check if disconnected peer is the selected video and if there still connected peers, then select the first\n        const selectedVideo =\n          prevState.selectedVideo.id === data.socketID && remoteStreams.length\n            ? { selectedVideo: remoteStreams[0] }\n            : null;\n\n        return {\n          // remoteStream: remoteStreams.length > 0 && remoteStreams[0].stream || null,\n          remoteStreams,\n          ...selectedVideo,\n        };\n      });\n    });\n\n    // this.socket.on('offerOrAnswer', (sdp) => {\n\n    //   this.textref.value = JSON.stringify(sdp)\n\n    //   // set sdp as remote description\n    //   this.pc.setRemoteDescription(new RTCSessionDescription(sdp))\n    // })\n\n    this.socket.on(\"online-peer\", (socketID) => {\n      console.log(\"connected peers ...\", socketID);\n\n      // create and send offer to the peer (data.socketID)\n      // 1. Create new pc\n      this.createPeerConnection(socketID, (pc) => {\n        // 2. Create Offer\n        if (pc)\n          pc.createOffer(this.state.sdpConstraints).then((sdp) => {\n            pc.setLocalDescription(sdp);\n\n            this.sendToPeer(\"offer\", sdp, {\n              local: this.socket.id,\n              remote: socketID,\n            });\n          });\n      });\n    });\n\n    this.socket.on(\"offer\", (data) => {\n      this.createPeerConnection(data.socketID, (pc) => {\n        pc.addStream(this.state.localStream);\n\n        pc.setRemoteDescription(new RTCSessionDescription(data.sdp)).then(\n          () => {\n            // 2. Create Answer\n            pc.createAnswer(this.state.sdpConstraints).then((sdp) => {\n              pc.setLocalDescription(sdp);\n\n              this.sendToPeer(\"answer\", sdp, {\n                local: this.socket.id,\n                remote: data.socketID,\n              });\n            });\n          }\n        );\n      });\n    });\n\n    this.socket.on(\"answer\", (data) => {\n      // get remote's peerConnection\n      const pc = this.state.peerConnections[data.socketID];\n      console.log(data.sdp);\n      pc.setRemoteDescription(\n        new RTCSessionDescription(data.sdp)\n      ).then(() => {});\n    });\n\n    this.socket.on(\"candidate\", (data) => {\n      // get remote's peerConnection\n      const pc = this.state.peerConnections[data.socketID];\n\n      if (pc) pc.addIceCandidate(new RTCIceCandidate(data.candidate));\n    });\n  };\n\n  switchVideo = (_video) => {\n    console.log(_video);\n    this.setState({\n      selectedVideo: _video,\n    });\n  };\n\n  render() {\n    console.log(this.state.localStream);\n\n    const statusText = (\n      <div style={{ color: \"yellow\", padding: 5 }}>{this.state.status}</div>\n    );\n\n    return (\n      <div>\n        <Video\n          videoStyles={{\n            zIndex: 2,\n            position: \"absolute\",\n            right: 0,\n            width: 200,\n            height: 200,\n            margin: 5,\n            backgroundColor: \"black\",\n          }}\n          // ref={this.localVideoref}\n          videoStream={this.state.localStream}\n          autoPlay\n          muted\n        ></Video>\n        <Video\n          videoStyles={{\n            zIndex: 1,\n            position: \"fixed\",\n            bottom: 0,\n            minWidth: \"100%\",\n            minHeight: \"100%\",\n            backgroundColor: \"black\",\n          }}\n          // ref={ this.remoteVideoref }\n          videoStream={\n            this.state.selectedVideo && this.state.selectedVideo.stream\n          }\n          autoPlay\n          //muted={this.state.muted}\n        ></Video>\n        <br />\n        <div\n          style={{\n            zIndex: 3,\n            position: \"absolute\",\n            margin: 10,\n            backgroundColor: \"#cdc4ff4f\",\n            padding: 10,\n            borderRadius: 5,\n          }}\n        >\n          {statusText}\n        </div>\n\n        <div\n          style={{\n            zIndex: 5,\n            position: \"absolute\",\n            margin: 10,\n            right: 10,\n            bottom: 120,\n          }}\n        >\n          <button\n            onMouseDown={() => this.setState({ mute: false })}\n            onMouseUp={() => this.setState({ mute: true })}\n          >\n            Push to talk\n          </button>\n        </div>\n\n        {/* <div>\n          <Videos\n            switchVideo={this.switchVideo}\n            remoteStreams={this.state.remoteStreams}\n          ></Videos>\n        </div> */}\n        <br />\n\n        {/* <div style={{zIndex: 1, position: 'fixed'}} >\n          <button onClick={this.createOffer}>Offer</button>\n          <button onClick={this.createAnswer}>Answer</button>\n          <br />\n          <textarea style={{ width: 450, height:40 }} ref={ref => { this.textref = ref }} />\n        </div> */}\n        {/* <br />\n        <button onClick={this.setRemoteDescription}>Set Remote Desc</button>\n        <button onClick={this.addCandidate}>Add Candidate</button> */}\n      </div>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}