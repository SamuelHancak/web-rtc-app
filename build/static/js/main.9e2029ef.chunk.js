(this["webpackJsonpweb-rtc-audio"]=this["webpackJsonpweb-rtc-audio"]||[]).push([[0],{39:function(e,t,n){e.exports=n(76)},44:function(e,t,n){},73:function(e,t){},76:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),i=n(36),r=n.n(i),c=(n(44),n(38)),s=n(11),d=n(6),l=n(2),u=n(3),m=n(5),f=n(4),h=n(37),v=n.n(h),p=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(e){var o;return Object(l.a)(this,n),(o=t.call(this,e)).state={},o}return Object(u.a)(n,[{key:"componentDidMount",value:function(){this.props.videoStream&&(this.video.srcObject=this.props.videoStream)}},{key:"componentWillReceiveProps",value:function(e){e.videoStream&&e.videoStream!==this.props.videoStream&&(this.video.srcObject=e.videoStream)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{style:Object(d.a)({},this.props.frameStyle)},a.a.createElement("video",{id:this.props.id,muted:this.props.muted,autoPlay:!0,style:Object(d.a)({},this.props.videoStyles),ref:function(t){e.video=t}}))}}]),n}(o.Component),g=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(e){var o;return Object(l.a)(this,n),(o=t.call(this,e)).state={rVideos:[],remoteStreams:[]},o}return Object(u.a)(n,[{key:"componentWillReceiveProps",value:function(e){if(this.props.remoteStreams!==e.remoteStreams){var t=e.remoteStreams.map((function(e,t){return a.a.createElement("div",{id:e.name,style:{display:"inline"},key:t},a.a.createElement(p,{videoStream:e.stream,frameStyle:{height:120,width:213,float:"left",padding:"0 3px"},videoStyles:{cursor:"disabled",objectFit:"cover",borderRadius:3,height:120,width:213}}))}));this.setState({remoteStreams:e.remoteStreams,rVideos:t})}}},{key:"render",value:function(){return a.a.createElement("div",{style:{zIndex:3,position:"fixed",padding:"6px 3px",backgroundColor:"rgba(0,0,0,0.3)",height:120,top:"auto",whiteSpace:"nowrap"}},this.state.rVideos)}}]),n}(o.Component),S={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},b={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},k={},y=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(e){var o;return Object(l.a)(this,n),(o=t.call(this,e)).getLocalStream=function(){var e={audio:!0,video:o.state.isAdmin?{width:{max:1280},height:{max:720},frameRate:{max:30}}:{width:{max:426},height:{max:240},frameRate:{max:15}}};return navigator.mediaDevices.getUserMedia(e).then((function(e){o.setState({localStream:e})})).catch((function(e){console.log("getUserMedia Error: ",e)}))},o.componentDidMount=function(){var e=o.state.isAdmin;o.getLocalStream().then((function(){var t=v.a.connect("https://coronastage-stream.herokuapp.com",{query:{admin:e}}),n=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t.emit(e,{socketId:t.id,payload:n})},a=function(e,t){try{var a=new RTCPeerConnection(S);k=Object(d.a)(Object(d.a)({},k),{},Object(s.a)({},e,a)),a.onicecandidate=function(e){var t=e.candidate;console.log("onicecandidate",{candidate:t}),t&&n("candidate",{candidate:t})},a.onnegotiationneeded=function(){console.log("onnegotiationneeded")},a.oniceconnectionstatechange=function(e){console.log("oniceconnectionstatechange",{event:e}),console.log(a)},a.ontrack=function(t){console.log("ontrack",{event:t});var n=t.track;n&&o.setState((function(t){var o=t.selectedVideo,a=t.remoteStreams,i=Object(c.a)(a),r=i.findIndex((function(t){return t.id===e}));return-1===r&&(r=i.push({id:e,name:e,stream:new MediaStream})-1),i[r].stream.addTrack(n),{selectedVideo:o||i[r],remoteStreams:i}}))},a.close=function(){},t(a)}catch(i){console.log("Something went wrong! pc not created!!",i),t(null)}};t.on("candidate",(function(e){var t=e.socketId,n=e.candidate,o=k[t];o&&o.addIceCandidate(new RTCIceCandidate(n))})),t.on("connectionSuccess",(function(t){var n=t.peerCount,a=e?n>0?"Total Connected Peers: ".concat(n):"Waiting for other peers to connect":"Connected";o.setState({status:a})})),e?(t.on("peerJoin",(function(e){var t=e.socketId,i=e.peerCount;console.log("peerJoin",{socketId:t,peerCount:i}),o.setState({status:i>0?"Total Connected Peers: ".concat(i):"Waiting for other peers to connect"}),a(t,(function(e){o.state.localStream&&o.state.localStream.getTracks().forEach((function(t){return e.addTrack(t)})),function(e){e.createOffer(b).then((function(t){return e.setLocalDescription(t)})).then((function(){n("offer",{desc:e.localDescription})}))}(e)}))})),t.on("answer",(function(e){var t=e.socketId,n=e.desc;console.log("answer",{socketId:t,desc:n});var o=k[t];o&&o.setRemoteDescription(new RTCSessionDescription(n))})),t.on("peerDisconnect",(function(e){var t=e.socketId;console.log("peerDisconnect",{socketId:t}),o.setState((function(e){var n=e.remoteStreams,o=e.selectedVideo;return{remoteStreams:n.filter((function(e){return e.id!==t})),selectedVideo:o&&o.id===t?n[0]:o}}))}))):t.on("offer",(function(e){var t=e.socketId,i=e.desc;console.log("offer",{socketId:t,desc:i}),a(t,(function(e){o.state.localStream&&o.state.localStream.getTracks().forEach((function(t){return e.addTrack(t)})),e.setRemoteDescription(new RTCSessionDescription(i)).then((function(){return e.createAnswer(b)})).then((function(t){return e.setLocalDescription(t)})).then((function(){n("answer",{desc:e.localDescription})}))}))}))}))},o.switchVideo=function(e){o.setState({selectedVideo:e})},o.state={localStream:null,remoteStreams:[],selectedVideo:null,status:"Please wait...",isAdmin:"/admin"===window.location.pathname},o}return Object(u.a)(n,[{key:"render",value:function(){var e=a.a.createElement("div",{style:{color:"yellow",padding:5}},this.state.status);return a.a.createElement("div",{style:{backgroundColor:"black",minHeight:"100%"}},this.state.isAdmin?a.a.createElement(a.a.Fragment,null,a.a.createElement("div",null,a.a.createElement(g,{remoteStreams:this.state.remoteStreams})),a.a.createElement(p,{videoStyles:{zIndex:2,position:"absolute",right:10,bottom:10,width:200,height:200,margin:5,backgroundColor:"black"},videoStream:this.state.localStream,autoPlay:!0,muted:!0}),a.a.createElement("div",{style:{zIndex:4,position:"absolute",margin:10,backgroundColor:"#cdc4ff4f",padding:10,borderRadius:5,right:10,bottom:200}},e)):a.a.createElement(a.a.Fragment,null,a.a.createElement(p,{videoStyles:{zIndex:2,position:"absolute",right:0,width:200,height:200,margin:5,backgroundColor:"black"},videoStream:this.state.localStream,autoPlay:!0,muted:!0}),this.state.selectedVideo?a.a.createElement(p,{videoStyles:{zIndex:1,position:"fixed",bottom:0,minWidth:"100%",minHeight:"100%",backgroundColor:"black"},videoStream:this.state.selectedVideo.stream,autoPlay:!0}):null,a.a.createElement("div",{style:{zIndex:4,position:"absolute",margin:10,backgroundColor:"#cdc4ff4f",padding:10,borderRadius:5}},e),a.a.createElement("div",{style:{zIndex:5,position:"absolute",margin:10,right:10,bottom:120}})))}}]),n}(o.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(y,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[39,1,2]]]);
//# sourceMappingURL=main.9e2029ef.chunk.js.map